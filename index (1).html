<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>LED Pattern Preview</title>
  <style>
    body { margin:0; font-family:sans-serif; display:flex; height:100vh; }
    #controls { width:300px; padding:20px; background:#f4f4f4; box-shadow:2px 0 5px rgba(0,0,0,0.1); }
    #controls label { margin-top:10px; display:block; }
    #controls select, #controls input[type=range], #controls button { width:100%; margin-top:5px; }
    #preview { flex:1; position:relative; }
    #timer { position:absolute; top:10px; right:10px; background:rgba(255,255,255,0.7); padding:5px 10px; border-radius:4px; }
    canvas { width:100%; height:100%; display:block; }
  </style>
</head>
<body>
  <div id="controls">
    <label>Color Palette:
      <select id="paletteSelect">
        <option>Pastel V1</option>
        <option>Pastel V2</option>
        <option>Rainbow V1</option>
        <option>Rainbow V2</option>
      </select>
    </label>
    <label>Pattern Mode:
      <select id="modeSelect">
        <option>Static</option>
        <option>Breathing (one)</option>
        <option>Breathing (multi)</option>
        <option>Crossfade</option>
      </select>
    </label>
    <label>Speed:
      <input id="speedSlider" type="range" min="0.2" max="5" step="0.6" value="1">
      <div id="speedLabel">1×</div>
    </label>
    <button id="startStop">START</button>
  </div>
  <div id="preview">
    <div id="timer">15.0s</div>
    <canvas id="ledCanvas"></canvas>
  </div>
  <script>
    const palettes = {
      "Pastel V1": [[250,237,203],[247,217,196],[242,198,222],[219,205,240],[198,222,241],[201,228,222]],
      "Pastel V2": [[255,183,243],[219,165,243],[196,161,244],[168,168,244],[158,187,244],[168,204,243]],
      "Rainbow V1": [[255,0,0],[255,127,0],[255,255,0],[0,255,0],[0,0,255],[139,0,255]],
      "Rainbow V2": [[255,204,0],[255,149,0],[255,59,48],[175,82,222],[0,122,255],[52,199,73]]
    };
    let duration=15000, fadeOut=1000, interval=40;
    let totalSteps = duration/interval, fadeSteps=fadeOut/interval;
    let canvas = document.getElementById('ledCanvas'), ctx = canvas.getContext('2d');
    let paletteSelect=document.getElementById('paletteSelect'), modeSelect=document.getElementById('modeSelect');
    let speedSlider=document.getElementById('speedSlider'), speedLabel=document.getElementById('speedLabel');
    let toggleBtn=document.getElementById('startStop'), timerDiv=document.getElementById('timer');
    canvas.width=canvas.clientWidth; canvas.height=canvas.clientHeight;
    let running=false, step=0, baseColor=[255,255,255], currentSpeed=1;
    function toHex(c){return '#' + c.map(v=>v.toString(16).padStart(2,'0')).join('');}
    function drawFrame(){
      let frac = step/totalSteps;
      let color=[0,0,0];
      let pal=palettes[paletteSelect.value], n=pal.length;
      if(modeSelect.value==='Static') color=baseColor;
      else if(modeSelect.value==='Breathing (one)'){
        if(step===0) baseColor=pal[Math.floor(Math.random()*n)];
        let phase=(frac*currentSpeed*2)%2; if(phase>1)phase=2-phase;
        color=baseColor.map(c=>c*phase);
      } else if(modeSelect.value==='Breathing (multi)'){
        let total=frac*currentSpeed*n;
        let idx=Math.floor(total)%n;
        let local=total-Math.floor(total);
        let phase=local*2; if(phase>1)phase=2-phase;
        color=pal[idx].map(c=>c*phase);
      } else if(modeSelect.value==='Crossfade'){
        let total=frac*n;
        let i=Math.floor(total), blend=total-i;
        let c1=pal[i%n],c2=pal[(i+1)%n];
        color=c1.map((c,k)=>c*(1-blend)+c2[k]*blend);
      }
      if(step>totalSteps-fadeSteps){let o=(step-(totalSteps-fadeSteps))/fadeSteps; color=color.map(c=>c*(1-o));}
      ctx.fillStyle=toHex(color.map(Math.round)); ctx.fillRect(0,0,canvas.width,canvas.height);
      let rem = ((totalSteps-step)*interval/1000).toFixed(1)+'s'; timerDiv.textContent=rem;
      step++; if(step>totalSteps) return stop();
    }
    function start(){
      currentSpeed=parseFloat(speedSlider.value);
      step=0; running=true; toggleBtn.textContent='STOP';
      paletteSelect.disabled=modeSelect.disabled=speedSlider.disabled=true;
      timerDiv.textContent=(duration/1000).toFixed(1)+'s';
      intervalId=setInterval(drawFrame, interval);
    }
    function stop(){ clearInterval(intervalId); running=false; toggleBtn.textContent='START'; paletteSelect.disabled=modeSelect.disabled=speedSlider.disabled=false; }
    speedSlider.oninput=()=>speedLabel.textContent=speedSlider.value+'×';
    toggleBtn.onclick=()=>running?stop():start();
  </script>
</body>
</html>